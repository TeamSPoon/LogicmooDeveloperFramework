
RewriteEngine On

<IfModule mime_module>
   AddType text/html .php .phps
</IfModule>

#RewriteCond   "$1.php"           -f
#RewriteCond   "$1.html"          !-f
#RewriteRule   "^(.*).html$"      "$1.php"

<Directory />    
    #AllowOverride All
    Options FollowSymLinks Indexes
    #Options +Includes
    #Options SymLinksIfOwnerMatch 
    #Order allow,deny
#    Allow from all
    #Require all granted
</Directory>

DirectoryIndex index.html index.htm index.php welcome.html

<Directory /opt/logicmoo_workspace/~html~>
  Options +Indexes
  AllowOverride all
  IndexOptions FancyIndexing HTMLTable
</Directory>
<Directory /opt/logicmoo_workspace/~html~>
  Options +Indexes
  AllowOverride all
  IndexOptions FancyIndexing HTMLTable
</Directory>

# Ensure that encoded slashes are not decoded but left in their encoded state.                                                                                                                                                                                                    
# http://doc.gitlab.com/ce/api/projects.html#get-single-project                                                                                                                                                                                                                   
#AllowEncodedSlashes NoDecode

ProxyPass /home http://localhost:3020/home
ProxyPass /cpack http://localhost:3020/cpack
ProxyPass /admin http://localhost:3020/admin
ProxyPass /yasgui http://localhost:3020/yasgui
ProxyPass /help http://localhost:3020/help
ProxyPass /user http://localhost:3020/user
ProxyPass /browse http://localhost:3020/browse
ProxyPass /filesystem http://localhost:3020/filesystem
ProxyPass /node_modules http://localhost:3020/node_modules
ProxyPass /ace http://localhost:3020/ace
#ProxyPass /icons http://localhost:3020/icons
ProxyPass /pengine http://localhost:3020/pengine
#ProxyPass /pldoc http://localhost:3020/swish/pldoc
ProxyPass /plweb http://localhost:3020/plweb
ProxyPass /servlets http://localhost:3020/servlets
ProxyPass /swish http://localhost:3020/swish
ProxyPass /icons http://localhost:3020/icons
ProxyPass /opt http://localhost:3020/opt
ProxyPass /oauth2/google http://localhost:3020/oauth2/google

ProxyPassReverse /swish/icons http://localhost:3020/icons
ProxyPassReverse / http://localhost:3020
ProxyPassReverse / http://logicmoo.org:3020

#ProxyPassReverse / https://www.logicmoo.org
#ProxyPassReverse / http://www.logicmoo.org
ProxyPassReverse / https://www.swi-prolog.org
ProxyPassReverse / https://edu.swi-prolog.org
ProxyPassReverse / http://www.swi-prolog.org
ProxyPassReverse / http://edu.swi-prolog.org

#ProxyPass /filesystems http://localhost:3020/filesystems
#ProxyPass /e http://localhost:3020/e
#ProxyPass /p/ http://localhost:3020/p/
#ProxyPass /help http://localhost:3020/help


RewriteCond %{HTTP:UPGRADE} ^WebSocket$   [NC]
RewriteCond %{HTTP:CONNECTION} ^Upgrade$ [NC]
RewriteRule .* ws://localhost:3020%{REQUEST_URI} [P,L]

Header always set X-Frame-Options "SAMEORIGIN"


Alias "/wiki" "/var/lib/mediawiki/"

ProxyPass /gitlab http://logicmoo.org:1082/gitlab
ProxyPassReverse /gitlab http://logicmoo.org:1082/gitlab
#ProxyPass /gitlab/ http://logicmoo.org:1082/gitlab/                          
#ProxyPassReverse /gitlab http://logicmoo.org:1082/gitlab
#ProxyPassReverse /gitlab http://logicmoo.org:1082
#ProxyPassReverse /gitlab https://logicmoo.org:1082/gitlab
#ProxyPassReverse /gitlab https://logicmoo.org:1082



#ProxyPassReverse /wiki/ http://wiki.cyc.com/wiki
#ProxyPassReverse /wiki/ http://wiki.cyc.com


ProxyPassReverse / http://localhost:4088
ProxyPassReverse / http://logicmoo.org:4088

#RewriteCond "%{ENV:rewritten}" "!=1"
#RewriteCond "%{ENV:rewritten}" "!1"
RewriteCond %{SERVER_PORT} !4088
#RewriteCond %{SERVER_PORT} !443
#RewriteCond %{SERVER_PORT} !80
RewriteCond %{SERVER_PORT} !"^4088$"
RewriteCond %{REQUEST_URI} !^/wordpress.*
RewriteCond %{REQUEST_URI} !^/gitlab.*
RewriteCond %{REQUEST_URI} !^/wiki.*
#RewriteCond %{REQUEST_URI} !^/port.*
RewriteCond %{REQUEST_URI} !^/$
RewriteCond %{REQUEST_URI} !^/index.*
RewriteCond %{REQUEST_URI} !^/old-index.*
RewriteCond %{REQUEST_URI} !^/favicon.*
RewriteCond %{REQUEST_URI} !^/assets/.*
RewriteCond %{REQUEST_URI} !^/vendor/.*
RewriteCond %{REQUEST_URI} !^/privacy.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-l
RewriteRule "^/(.*)" "http://localhost:4088/$1" [P,L,E=rewritten:1,E=url:$1,QSA]
#RewriteRule "^/(.*)" "http://localhost:4088/$1" [P,L,QSA]
# RewriteRule .? /index.php?url=%{REQUEST_URI} [L,QSA]

#ProxyPass /wordpress/ https://logicmoo.org:1800/
#ProxyPassReverse /wordpress/ https://logicmoo.org:1800/
#RewriteCond %{REQUEST_URI} !^/gitlab.*
#
#
#RewriteCond %{REQUEST_URI} !^/wordpress.*

